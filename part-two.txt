Part Two Database Project:

Goal is to keep track of people who have multiple addresses and multiple phone numbers


Please create a relational database schema and show examples of the following queries:


- Display people and their phone numbers

- Display people and their addresses

- Display people and their addresses only if they are in the state of California

- Show how many people have addresses in each state

- Show the % of people that have multiple addresses

**** Database schema ****

people
    - id(primary key)
    - fname
    - lname

phonenumbers
    - id(primary key)
    - number
    - type

addresses
    - id(primary key)
    - streetnamenumber
    - unitnumber (if applicable)
    - city
    - state
    - zipcode

peopleaddresses
    - id(primary key)
    - personid(foreign key)
    - addressid(foreign key)

peoplenumbers
    - id(primary key)
    - personid(foreign key) 
    - phonenumberid(foreign key)

**** SQL queries ****

1. Display people and their phone numbers

    SELECT 
        people.fname, people.lname, phonenumbers.number 
    FROM people 
         JOIN peoplenumbers ON(people.id = peoplenumbers.personid) 
         JOIN phonenumbers ON(peoplenumbers.phonenumberid = phonenumbers.id);

2. Display people and their addresses

    SELECT 
        people.fname, people.lname, addresses.streetnamenumber, addresses.unitnumber, addresses.city, addresses.state, addresses.zipcode 
    FROM people 
        JOIN peopleaddresses ON(people.id = peopleaddresses.personid) 
        JOIN addresses ON(peopleadresses.addressid = addresses.id);

3. Display people and their addresses only if they are in the state of California
    
    SELECT 
        people.firstName, people.lastName, addresses.streetnamenumber, addresses.unitnumber, addresses.city, addresses.state, addresses.zipcode 
    FROM people 
         JOIN peopleaddresses ON(people.id = peopleaddresses.personid) 
         JOIN addresses ON(peopleadresses.addressid = addresses.id) 
    WHERE addresses.state = 'CA';

4. Show how many people have addresses in each state

    SELECT 
        addresses.state, count(addresses.state) 
    FROM people 
         JOIN peopleaddresses ON(people.id = peopleaddresses.personid) 
         JOIN addresses ON(peopleaddresses.addressid = addresses.id) 
    GROUP BY addresses.state;

5. Show the % of people that have multiple addresses 
    
    I couldn't find a way to do this in a single query. So I did it in a nested query

    SELECT 
        avg(indMultiAddr) * 100 AS pctMultiAddr
    FROM (select personid,
          case when count(personid) > 1 then 1 else 0 end indMultiAddr
          from peopleaddresses
          GROUP BY 1) AS a;


